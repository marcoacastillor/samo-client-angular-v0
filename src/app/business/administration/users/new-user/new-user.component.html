<section>
    <!-- start menu main-->
    <div class="row bg-gray">
        <div class="col-sm-6 text-left">
            Agregar o actualizar información
        </div>
        <div class="col-sm-6 text-right">
            <div class="btn-group btn-group-sm">
                <button type="button" (click)="cancelUser()" class="btn btn-outline-primary btn-sm">
                    <fa-icon [icon]="faThList" class="text-primary mb-2 mr-1" title="Crear registro"></fa-icon>Ver todos
                </button>
            </div>
        </div>
    </div>
    <!-- end menu main-->
    

    <!-- start content -->
    <div class="row margin-top-1rem">
        <div class="col-sm-12">
            <form [formGroup]="userForm">
                <div class="row">
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label for="username">Nombre Usuario</label>
                            <input type="text" class="form-control text-small" placeholder="Nombre de usuario" formControlName="username" required>
                            <small *ngIf="mustShowError('username')" class="form-text alert-danger">
                            Nombre es obligatorio
                            </small>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label for="username">Correo electronico</label>
                            <input type="text" class="form-control text-small" placeholder="Correo electronico" formControlName="email" required>
                            <small *ngIf="mustShowError('email')" class="form-text alert-danger">
                            <small *ngIf="hasError('email', 'email')"  class="form-text alert-danger">
                                Debe ingresar un correo válido
                            </small>
                            </small>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label for="fk_id_enterprise">Empresa</label>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <button type="button" class="btn text-small btn-sm btn-outline-primary" data-toggle="modal" data-target="#enterpriseModal">
                                        <fa-icon [icon]="faPlusCircle" class="text-primary mb-2 mr-1" title="Crear registro"></fa-icon>
                                    </button>
                                </div>
                                <select class="form-control form-control-sm text-small" formControlName="fk_id_enterprise" (change)="getEmployeesByEnterprise(); getPositionByEnterprise()" required>
                                    <option value="" selected>Seleccione</option>
                                    <option value="{{enterprise.pk_id_enterprise}}" *ngFor="let enterprise of enterpriseList">{{enterprise.name}}</option>
                                </select>
                                <div class="col-sm-12">
                                    <small *ngIf="mustShowError('fk_id_enterprise')" class="form-text alert-danger">
                                        Empresa es obligatorio
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <label for="fk_id_person">Persona</label>
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <button *ngIf="userForm.value.fk_id_enterprise" type="button" class="btn text-small btn-sm btn-outline-primary" data-toggle="modal" data-target="#personModal">
                                    <fa-icon [icon]="faPlusCircle" class="text-primary mb-2 mr-1" title="Crear registro"></fa-icon>
                                </button>
                            </div>
                            <select class="form-control text-small" formControlName="fk_id_person">
                                <option value="" selected>Seleccione</option>
                                <option value="{{person.pk_id_person}}" *ngFor="let person of personList">{{person.names}} {{person.last_names}}</option>
                            </select>
                        </div>
                    </div> 
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label for="rol">rol</label>
                            <select class="form-control text-small" formControlName="fk_id_rol" (change)="getOptions()">
                                <option value="" selected>Seleccione</option>
                                <option value="{{rol.pk_id_rol}}" *ngFor="let rol of rolList">{{rol.name}}</option>
                            </select>
                            <small *ngIf="mustShowError('fk_id_rol')" class="form-text alert-danger">
                                Rol es obligatorio
                            </small>
                        </div>
                    </div>          
                </div>
                <div class="row">
                    <div class="col-sm-4">
                        <div class="form-group">
                        <label for="password">Contraseña</label>
                        <input type="password" class="form-control text-small" placeholder="Contraseña" formControlName="password" required>
                        <span *ngIf="mustShowError('password')">
                            <small *ngIf="hasError('password', 'required')"  class="form-text alert-danger">
                            contraseña es obligatoria
                            </small>
                            <small *ngIf="hasError('password', 'minlength')"  class="form-text alert-danger">
                                La contraseña debe contener al menos {{getErrors('password').minlength.requiredLength}} digitos
                            </small>
                        </span>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="form-group">
                        <label for="state">Estado de usuario</label>
                        <select class="form-control text-small" formControlName="state_user" required>
                            <option value="" selected>Seleccione</option>
                            <option value="{{state.value}}" *ngFor="let state of statesUser">{{state.name}}</option>
                        </select>
                        <span *ngIf="mustShowError('state_user')">
                            <small *ngIf="hasError('state_user', 'required')"  class="form-text alert-danger">
                                Estado es obligatorio
                            </small>
                        </span>
                        </div>
                    </div>
                    <div class="col-sm-4" *ngIf="rol">
                        <ul>
                        <li *ngFor="let option of rol.options">{{option.code }}</li>
                        </ul> 
                    </div>
                </div>

                <!--start buttons form-->
                <div class="row justify-content-end">
                    <div class="col-sm-4 text-right align-self-end">
                        <button *ngIf="user.pk_id_user" type="submit" class="btn btn-outline-success btn-sm mb-2 mr-1" [disabled]="userForm.invalid" (click)="updateUser()">Actualizar</button>
                        <button *ngIf="!user.pk_id_user" type="submit" class="btn btn-outline-primary btn-sm mb-2 mr-1" [disabled]="userForm.invalid" (click)="createUser()">Guardar</button>
                    </div>
                </div>
                <!--end buttons form-->
            </form>
        </div>
    </div>
    <!-- end content -->
</section>

<!-- start modal person-->
<app-modal-person
    [pk_id_enterprise]="userForm.value.fk_id_enterprise"
    [typesIdList]="typesIdList"
    [laboralStateList]="laboralStateList"
    [positionList]="positionList"
    [salaryTypeList]="salaryTypeList"
    (create)="createPerson($event)"
>
</app-modal-person>
<!-- end modal person-->

<!-- start modal enterprise-->
<app-modal-enterprise
    (create)="createEnterprise($event)"
    [sizesList]="sizesList"
>
</app-modal-enterprise>
<!-- end modal enterprise-->